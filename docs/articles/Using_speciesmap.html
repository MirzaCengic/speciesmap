<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to speciesmap • speciesmap</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">speciesmap</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Using_speciesmap.html">An introduction to speciesmap</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RemkoDuursma/speciesmap">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>An introduction to speciesmap</h1>
                        <h4 class="author">Remko Duursma</h4>
            
            <h4 class="date">2017-08-10</h4>
          </div>

    
    
<div class="contents">
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>To install the speciesmap package from github, use the following command. The package is not yet available on CRAN.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"remkoduursma/speciesmap"</span>)</code></pre></div>
<p>Note the message on loading the package. When using <code>speciesmap</code>, please cite the original data sources!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(speciesmap)</code></pre></div>
<pre><code>## The speciesmap package is an interface to the following services -
## please visit those sites for information and CITATIONS:
## Worldclim - www.worldclim.org
## ALA - www.ala.org.au
## GBIF - www.gbif.org
## CGIAR-CSI - http://www.cgiar-csi.org/data/global-aridity-and-pet-database</code></pre>
</div>
<div id="species-occurrences" class="section level2">
<h2 class="hasAnchor">
<a href="#species-occurrences" class="anchor"></a>Species occurrences</h2>
<p>If you are only interested in extracting species occurrences, <code>speciesmap</code> provides thin wrappers around <code>rgbif</code> and <code>ALA4R</code> packages. The output is harmonized and simplified, returning a dataframe with species, latitude and longitude for all occurrences returned by the database. Some checking on the output is also performed, as well as useful error messages when either data service is unresponsive. If no records are found a dataframe with the species, and a single NA for latitude and longitude is returned.</p>
<p>To extract occurrences from the ALA,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">benthocc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_occurrences.html">get_occurrences_ala</a></span>(<span class="st">"Eucalyptus benthamii"</span>) </code></pre></div>
<p>This gives (first 6 rows shown):</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">species</th>
<th align="right">longitude</th>
<th align="right">latitude</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.0000</td>
<td align="right">-33.0000</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.0000</td>
<td align="right">-33.0000</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="left">Eucalyptus benthamii</td>
<td align="right">176.0000</td>
<td align="right">-37.0000</td>
</tr>
<tr class="even">
<td>4</td>
<td align="left">Eucalyptus benthamii</td>
<td align="right">149.1167</td>
<td align="right">-35.2667</td>
</tr>
<tr class="odd">
<td>17</td>
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.4000</td>
<td align="right">-33.8000</td>
</tr>
<tr class="even">
<td>18</td>
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.3800</td>
<td align="right">-33.8200</td>
</tr>
</tbody>
</table>
<p>The corresponding function for GBIF is <code>get_occurrences_gbif</code>.</p>
<p>Both <code>get_occurrences_*</code> functions are vectorized, so you can do:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">benthocc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_occurrences.html">get_occurrences_ala</a></span>(<span class="kw">c</span>(<span class="st">"Eucalyptus benthamii"</span>,<span class="st">"Eucalyptus globulus"</span>))</code></pre></div>
<p>for example.</p>
</div>
<div id="rasterizing" class="section level2">
<h2 class="hasAnchor">
<a href="#rasterizing" class="anchor"></a>Rasterizing</h2>
<p>One of the motivating factors for writing <code>speciesmap</code> is the ability to quickly rasterize occurrences into a spatial resolution that matches climate data (in particular, WorldClim). At the moment only one resolution is possible, but this issue will be removed in a future version.</p>
<p>Rasterizing works by storing the latitude and longitude of 10min degree cells where the species has been observed at least once. The idea is to remove bias towards heavily sampled areas, since the main objective of the package is to study climate occupancy of species.</p>
<p>We can simply do,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">benthoccras &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rasterize_occurrences.html">rasterize_occurrences</a></span>(benthocc)</code></pre></div>
<p>The resulting object looks just like before, but has fewer rows. In this case, this rare species of Eucalyptus occurs in only thirteen 10min cells.</p>
</div>
<div id="climate-at-species-occurrences" class="section level2">
<h2 class="hasAnchor">
<a href="#climate-at-species-occurrences" class="anchor"></a>Climate at species occurrences</h2>
<p>The main function in <code>speciesmap</code> is <code>climate_presence</code>, which performs all steps at once:</p>
<ul>
<li>Find species occurrences from ALA, GBIF or both.</li>
<li>Rasterize occurrences (optionally)</li>
<li>Extract climate variables of interest from WorldClim and CGIAR-CSI (PET)</li>
<li>Download WorldClim layers if necessary first</li>
</ul>
<p>It is necessary to set the path to where the WorldClim data will be downloaded. It is of course recommended you recycle this between projects. Use the <code>options</code> as below.</p>
<p>For potential evapotranspiration, the package extracts data from the CGIAR-CSI database (Zomer et al.), which has to be manually downloaded first.</p>
<p>To do this, visit (), and manually download the file ‘Global PET - Annual.zip’ (follow ‘Download from the HarvestChoice Dropbox’), and unzip it in some directory. Then set the path with options() as shown below.</p>
<p>In this example we find potential evapotranspiration, average temperature, maximum temperature at the rasterized locations of <em>Eucalyptus benthamii</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">worldclimpath=</span><span class="st">"c:/data/worldclim"</span>, 
        <span class="dt">zomerpetpath=</span><span class="st">"c:/data/zomer"</span>)
benthclim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/climate_presence.html">climate_presence</a></span>(<span class="st">"Eucalyptus benthamii"</span>, <span class="dt">database=</span><span class="st">"ALA"</span>,
                              <span class="dt">vars=</span><span class="kw">c</span>(<span class="st">"pet"</span>,<span class="st">"tavg"</span>,<span class="st">"tmax"</span>))</code></pre></div>
<p>The output is monthly, in wide format (shown below are only the first few columns and first few rows), with the exception of PET, which is only provided as an annual value.</p>
<table class="table">
<thead><tr class="header">
<th align="left">species</th>
<th align="right">longitude</th>
<th align="right">latitude</th>
<th align="right">tavg_1</th>
<th align="right">tavg_2</th>
<th align="right">tavg_3</th>
<th align="right">tavg_4</th>
<th align="right">tavg_5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.0833</td>
<td align="right">-33.08333</td>
<td align="right">21.55500</td>
<td align="right">21.07525</td>
<td align="right">18.70675</td>
<td align="right">14.78325</td>
<td align="right">11.50100</td>
</tr>
<tr class="even">
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.7500</td>
<td align="right">-33.58333</td>
<td align="right">22.96700</td>
<td align="right">22.70400</td>
<td align="right">20.97100</td>
<td align="right">17.70400</td>
<td align="right">14.49050</td>
</tr>
<tr class="odd">
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.4167</td>
<td align="right">-33.75000</td>
<td align="right">19.63175</td>
<td align="right">19.43775</td>
<td align="right">17.60500</td>
<td align="right">14.30125</td>
<td align="right">11.47475</td>
</tr>
<tr class="even">
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.5833</td>
<td align="right">-33.75000</td>
<td align="right">21.49150</td>
<td align="right">21.37075</td>
<td align="right">19.54650</td>
<td align="right">16.40525</td>
<td align="right">13.59300</td>
</tr>
<tr class="odd">
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.4167</td>
<td align="right">-33.91667</td>
<td align="right">20.79825</td>
<td align="right">20.70950</td>
<td align="right">18.82900</td>
<td align="right">15.46750</td>
<td align="right">12.73600</td>
</tr>
<tr class="even">
<td align="left">Eucalyptus benthamii</td>
<td align="right">150.5833</td>
<td align="right">-33.91667</td>
<td align="right">21.57100</td>
<td align="right">21.47425</td>
<td align="right">19.65025</td>
<td align="right">16.52100</td>
<td align="right">13.69700</td>
</tr>
</tbody>
</table>
<p>The monthly values can be reshaped, using a combination of <code>melt</code> (from <code>reshape2</code>), <code>separate</code> and <code>spread</code> (both from <code>tidyr</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
<span class="kw">library</span>(reshape2)
benthlong &lt;-<span class="st"> </span>benthclim <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>PET) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars=</span><span class="kw">c</span>(<span class="st">"species"</span>,<span class="st">"longitude"</span>,<span class="st">"latitude"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(<span class="st">"variable"</span>, <span class="kw">c</span>(<span class="st">"variable"</span>,<span class="st">"month"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(variable, value)

<span class="kw">head</span>(benthlong)</code></pre></div>
<pre><code>##                species longitude latitude month     tavg     tmax
## 1 Eucalyptus benthamii  149.0833   -35.25     1 20.31100 25.77875
## 2 Eucalyptus benthamii  149.0833   -35.25    10 12.74300 19.59350
## 3 Eucalyptus benthamii  149.0833   -35.25    11 15.44475 22.29775
## 4 Eucalyptus benthamii  149.0833   -35.25    12 18.64375 25.49450
## 5 Eucalyptus benthamii  149.0833   -35.25     2 20.20525 25.67675
## 6 Eucalyptus benthamii  149.0833   -35.25     3 17.86575 23.33700</code></pre>
<p>Long format may be useful to make a plot of average temperature vs. Month for all locations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(benthlong, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(month)), <span class="dt">y=</span>tavg, <span class="dt">group=</span><span class="kw">interaction</span>(latitude, longitude))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">"Month"</span>, <span class="dt">y=</span><span class="st">"Average temperature (deg C)"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)</code></pre></div>
<p><img src="Using_speciesmap_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>Using the long format, it is straightforward to make any sort of summary variable by location that you want. Alternatively, you can use the built-in <code>annualize_clim</code>, like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Only first 6 rows shown.</span>
<span class="co"># annualize_clim renames tavg into MAT (mean annual temperature), </span>
<span class="co"># and prec into MAP (mean annual precipitation)</span>
<span class="kw">library</span>(magrittr)
benthclim <span class="op">%&gt;%</span><span class="st"> </span>annualize_clim</code></pre></div>
<pre><code>##                species longitude  latitude      MAT     tmax  PET
## 1 Eucalyptus benthamii  150.0833 -33.08333 14.75913 20.28431 1224
## 2 Eucalyptus benthamii  150.7500 -33.58333 17.19596 23.33217 1366
## 3 Eucalyptus benthamii  150.4167 -33.75000 14.03294 18.90269 1147
## 4 Eucalyptus benthamii  150.5833 -33.75000 15.99740 21.48617 1300
## 5 Eucalyptus benthamii  150.4167 -33.91667 15.19390 20.17383 1213
## 6 Eucalyptus benthamii  150.5833 -33.91667 16.09660 21.70408 1307</code></pre>
<p>The above result gives annual values for each recorded location of the species. The final step is to summarize these climate variables across the entire range of the species. Once again you can produce summaries yourself, or use the built-in function <code>aggregate_clim</code>, which applies functions to each climate column. The default is to calculate the mean and 5%, 95% quantiles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">benthclim <span class="op">%&gt;%</span><span class="st"> </span>annualize_clim <span class="op">%&gt;%</span><span class="st"> </span>aggregate_clim</code></pre></div>
<pre><code>##                species ncells MAT_mean MAT_q05  MAT_q95 PET_mean PET_q05
## 1 Eucalyptus benthamii     13 15.42152 13.6772 17.06512 1263.583  1164.6
##   PET_q95 tmax_mean tmax_q05 tmax_q95
## 1 1340.15  20.93329 19.08966 23.19164</code></pre>
<p>The result shown is for a single species, but if multiple species were present in the search, one row per species is shown.</p>
<p>Finally, you can also provide custom functions (note that function names have to be quoted).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">benthclim <span class="op">%&gt;%</span><span class="st"> </span>annualize_clim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/get_climate_vars.html">aggregate_clim</a></span>(., <span class="dt">funs=</span><span class="kw">c</span>(<span class="st">"min"</span>, <span class="st">"median"</span>, <span class="st">"max"</span>) )</code></pre></div>
<pre><code>##                species ncells  MAT_max MAT_median  MAT_min PET_max
## 1 Eucalyptus benthamii     13 17.19596   15.52423 13.24242    1366
##   PET_median PET_min tmax_max tmax_median tmax_min
## 1     1285.5    1147 23.33217    20.88524 18.90269</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#installation">Installation</a></li>
      <li><a href="#species-occurrences">Species occurrences</a></li>
      <li><a href="#rasterizing">Rasterizing</a></li>
      <li><a href="#climate-at-species-occurrences">Climate at species occurrences</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://www.remkoduursma.com">Remko Duursma</a>, Daisy Duursma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
